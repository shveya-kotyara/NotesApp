"use strict";

var _require = require('path'),
    dirname = _require.dirname;

var _require2 = require('./find-made.js'),
    findMade = _require2.findMade,
    findMadeSync = _require2.findMadeSync;

var _require3 = require('./mkdirp-manual.js'),
    mkdirpManual = _require3.mkdirpManual,
    mkdirpManualSync = _require3.mkdirpManualSync;

var mkdirpNative = function mkdirpNative(path, opts) {
  opts.recursive = true;
  var parent = dirname(path);
  if (parent === path) return opts.mkdirAsync(path, opts);
  return findMade(opts, path).then(function (made) {
    return opts.mkdirAsync(path, opts).then(function () {
      return made;
    })["catch"](function (er) {
      if (er.code === 'ENOENT') return mkdirpManual(path, opts);else throw er;
    });
  });
};

var mkdirpNativeSync = function mkdirpNativeSync(path, opts) {
  opts.recursive = true;
  var parent = dirname(path);
  if (parent === path) return opts.mkdirSync(path, opts);
  var made = findMadeSync(opts, path);

  try {
    opts.mkdirSync(path, opts);
    return made;
  } catch (er) {
    if (er.code === 'ENOENT') return mkdirpManualSync(path, opts);else throw er;
  }
};

module.exports = {
  mkdirpNative: mkdirpNative,
  mkdirpNativeSync: mkdirpNativeSync
};