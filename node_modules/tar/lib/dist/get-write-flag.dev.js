"use strict";

// Get the appropriate flag to use for creating files
// We use fmap on Windows platforms for files less than
// 512kb.  This is a fairly low limit, but avoids making
// things slower in some cases.  Since most of what this
// library is used for is extracting tarballs of many
// relatively small files in npm packages and the like,
// it can be a big boost on Windows platforms.
// Only supported in Node v12.9.0 and above.
var platform = process.env.__FAKE_PLATFORM__ || process.platform;
var isWindows = platform === 'win32';

var fs = global.__FAKE_TESTING_FS__ || require('fs');
/* istanbul ignore next */


var _fs$constants = fs.constants,
    O_CREAT = _fs$constants.O_CREAT,
    O_TRUNC = _fs$constants.O_TRUNC,
    O_WRONLY = _fs$constants.O_WRONLY,
    _fs$constants$UV_FS_O = _fs$constants.UV_FS_O_FILEMAP,
    UV_FS_O_FILEMAP = _fs$constants$UV_FS_O === void 0 ? 0 : _fs$constants$UV_FS_O;
var fMapEnabled = isWindows && !!UV_FS_O_FILEMAP;
var fMapLimit = 512 * 1024;
var fMapFlag = UV_FS_O_FILEMAP | O_TRUNC | O_CREAT | O_WRONLY;
module.exports = !fMapEnabled ? function () {
  return 'w';
} : function (size) {
  return size < fMapLimit ? fMapFlag : 'w';
};