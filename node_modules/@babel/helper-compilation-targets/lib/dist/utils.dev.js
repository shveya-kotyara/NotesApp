"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.semverMin = semverMin;
exports.semverify = semverify;
exports.isUnreleasedVersion = isUnreleasedVersion;
exports.getLowestUnreleased = getLowestUnreleased;
exports.getLowestImplementedVersion = getLowestImplementedVersion;

var _semver = _interopRequireDefault(require("semver"));

var _helperValidatorOption = require("@babel/helper-validator-option");

var _package = require("../package.json");

var _targets = require("./targets");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

var versionRegExp = /^(\d+|\d+.\d+)$/;
var v = new _helperValidatorOption.OptionValidator(_package.name);

function semverMin(first, second) {
  return first && _semver["default"].lt(first, second) ? first : second;
}

function semverify(version) {
  if (typeof version === "string" && _semver["default"].valid(version)) {
    return version;
  }

  v.invariant(typeof version === "number" || typeof version === "string" && versionRegExp.test(version), "'".concat(version, "' is not a valid version"));
  var split = version.toString().split(".");

  while (split.length < 3) {
    split.push("0");
  }

  return split.join(".");
}

function isUnreleasedVersion(version, env) {
  var unreleasedLabel = _targets.unreleasedLabels[env];
  return !!unreleasedLabel && unreleasedLabel === version.toString().toLowerCase();
}

function getLowestUnreleased(a, b, env) {
  var unreleasedLabel = _targets.unreleasedLabels[env];
  var hasUnreleased = [a, b].some(function (item) {
    return item === unreleasedLabel;
  });

  if (hasUnreleased) {
    return a === hasUnreleased ? b : a || b;
  }

  return semverMin(a, b);
}

function getLowestImplementedVersion(plugin, environment) {
  var result = plugin[environment];

  if (!result && environment === "android") {
    return plugin.chrome;
  }

  return result;
}