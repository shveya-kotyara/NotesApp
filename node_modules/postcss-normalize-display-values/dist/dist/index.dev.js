"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _postcss = require("postcss");

var _postcss2 = _interopRequireDefault(_postcss);

var _postcssValueParser = require("postcss-value-parser");

var _postcssValueParser2 = _interopRequireDefault(_postcssValueParser);

var _cssnanoUtilGetMatch = require("cssnano-util-get-match");

var _cssnanoUtilGetMatch2 = _interopRequireDefault(_cssnanoUtilGetMatch);

var _map = require("./lib/map");

var _map2 = _interopRequireDefault(_map);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    "default": obj
  };
}

var getMatch = (0, _cssnanoUtilGetMatch2["default"])(_map2["default"]);

function evenValues(list, index) {
  return index % 2 === 0;
}

exports["default"] = _postcss2["default"].plugin("postcss-normalize-display-values", function () {
  return function (css) {
    var cache = {};
    css.walkDecls(/display/i, function (decl) {
      var value = decl.value;

      if (cache[value]) {
        decl.value = cache[value];
        return;
      }

      var _ref = (0, _postcssValueParser2["default"])(value),
          nodes = _ref.nodes;

      if (nodes.length === 1) {
        cache[value] = value;
        return;
      }

      var match = getMatch(nodes.filter(evenValues).map(function (n) {
        return n.value.toLowerCase();
      }));

      if (!match) {
        cache[value] = value;
        return;
      }

      var result = match;
      decl.value = result;
      cache[value] = result;
    });
  };
});
module.exports = exports["default"];