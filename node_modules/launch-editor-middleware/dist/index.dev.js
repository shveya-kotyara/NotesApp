"use strict";

var url = require('url');

var path = require('path');

var launch = require('launch-editor');

module.exports = function (specifiedEditor, srcRoot, onErrorCallback) {
  if (typeof specifiedEditor === 'function') {
    onErrorCallback = specifiedEditor;
    specifiedEditor = undefined;
  }

  if (typeof srcRoot === 'function') {
    onErrorCallback = srcRoot;
    srcRoot = undefined;
  }

  srcRoot = srcRoot || process.cwd();
  return function launchEditorMiddleware(req, res, next) {
    var _ref = url.parse(req.url, true).query || {},
        file = _ref.file;

    if (!file) {
      res.statusCode = 500;
      res.end("launch-editor-middleware: required query param \"file\" is missing.");
    } else {
      launch(path.resolve(srcRoot, file), specifiedEditor, onErrorCallback);
      res.end();
    }
  };
};