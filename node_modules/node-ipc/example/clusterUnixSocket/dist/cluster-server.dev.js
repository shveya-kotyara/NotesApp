"use strict";

var fs = require('fs');

var ipc = require('../../../node-ipc');

var cpuCount = require('os').cpus().length;

var cluster = require('cluster');

var socketPath = '/tmp/ipc.sock';
ipc.config.unlink = false;

if (cluster.isMaster) {
  if (fs.existsSync(socketPath)) {
    fs.unlinkSync(socketPath);
  }

  for (var i = 0; i < cpuCount; i++) {
    cluster.fork();
  }
} else {
  ipc.serve(socketPath, function () {
    ipc.server.on('currentDate', function (data, socket) {
      console.log("pid ".concat(process.pid, " got: "), data);
    });
  });
  ipc.server.start();
  console.log("pid ".concat(process.pid, " listening on ").concat(socketPath));
}