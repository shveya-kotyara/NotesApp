'use strict';

var u = require('universalify').fromCallback;

var fs = require('graceful-fs');

var path = require('path');

var mkdir = require('../mkdirs');

var pathExists = require('../path-exists').pathExists;

function outputFile(file, data, encoding, callback) {
  if (typeof encoding === 'function') {
    callback = encoding;
    encoding = 'utf8';
  }

  var dir = path.dirname(file);
  pathExists(dir, function (err, itDoes) {
    if (err) return callback(err);
    if (itDoes) return fs.writeFile(file, data, encoding, callback);
    mkdir.mkdirs(dir, function (err) {
      if (err) return callback(err);
      fs.writeFile(file, data, encoding, callback);
    });
  });
}

function outputFileSync(file) {
  var dir = path.dirname(file);

  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
    args[_key - 1] = arguments[_key];
  }

  if (fs.existsSync(dir)) {
    return fs.writeFileSync.apply(fs, [file].concat(args));
  }

  mkdir.mkdirsSync(dir);
  fs.writeFileSync.apply(fs, [file].concat(args));
}

module.exports = {
  outputFile: u(outputFile),
  outputFileSync: outputFileSync
};