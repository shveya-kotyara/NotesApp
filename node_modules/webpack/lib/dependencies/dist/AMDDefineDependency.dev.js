/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/
"use strict";

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

var NullDependency = require("./NullDependency");

var AMDDefineDependency =
/*#__PURE__*/
function (_NullDependency) {
  _inherits(AMDDefineDependency, _NullDependency);

  function AMDDefineDependency(range, arrayRange, functionRange, objectRange, namedModule) {
    var _this;

    _classCallCheck(this, AMDDefineDependency);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(AMDDefineDependency).call(this));
    _this.range = range;
    _this.arrayRange = arrayRange;
    _this.functionRange = functionRange;
    _this.objectRange = objectRange;
    _this.namedModule = namedModule;
    _this.localModule = null;
    return _this;
  }

  _createClass(AMDDefineDependency, [{
    key: "type",
    get: function get() {
      return "amd define";
    }
  }]);

  return AMDDefineDependency;
}(NullDependency);

AMDDefineDependency.Template =
/*#__PURE__*/
function () {
  function AMDDefineDependencyTemplate() {
    _classCallCheck(this, AMDDefineDependencyTemplate);
  }

  _createClass(AMDDefineDependencyTemplate, [{
    key: "apply",
    value: function apply(dependency, source) {
      var branch = this.branch(dependency);
      var defAndText = this.definitions[branch];
      var definitions = defAndText[0];
      var text = defAndText[1];
      this.replace(dependency, source, definitions, text);
    }
  }, {
    key: "localModuleVar",
    value: function localModuleVar(dependency) {
      return dependency.localModule && dependency.localModule.used && dependency.localModule.variableName();
    }
  }, {
    key: "branch",
    value: function branch(dependency) {
      var localModuleVar = this.localModuleVar(dependency) ? "l" : "";
      var arrayRange = dependency.arrayRange ? "a" : "";
      var objectRange = dependency.objectRange ? "o" : "";
      var functionRange = dependency.functionRange ? "f" : "";
      return localModuleVar + arrayRange + objectRange + functionRange;
    }
  }, {
    key: "replace",
    value: function replace(dependency, source, definition, text) {
      var localModuleVar = this.localModuleVar(dependency);

      if (localModuleVar) {
        text = text.replace(/XXX/g, localModuleVar.replace(/\$/g, "$$$$"));
        definition = definition.replace(/XXX/g, localModuleVar.replace(/\$/g, "$$$$"));
      }

      if (dependency.namedModule) {
        text = text.replace(/YYY/g, JSON.stringify(dependency.namedModule));
      }

      var texts = text.split("#");
      if (definition) source.insert(0, definition);
      var current = dependency.range[0];

      if (dependency.arrayRange) {
        source.replace(current, dependency.arrayRange[0] - 1, texts.shift());
        current = dependency.arrayRange[1];
      }

      if (dependency.objectRange) {
        source.replace(current, dependency.objectRange[0] - 1, texts.shift());
        current = dependency.objectRange[1];
      } else if (dependency.functionRange) {
        source.replace(current, dependency.functionRange[0] - 1, texts.shift());
        current = dependency.functionRange[1];
      }

      source.replace(current, dependency.range[1] - 1, texts.shift());
      if (texts.length > 0) throw new Error("Implementation error");
    }
  }, {
    key: "definitions",
    get: function get() {
      return {
        f: ["var __WEBPACK_AMD_DEFINE_RESULT__;", "!(__WEBPACK_AMD_DEFINE_RESULT__ = (#).call(exports, __webpack_require__, exports, module),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))"],
        o: ["", "!(module.exports = #)"],
        of: ["var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_RESULT__;", "!(__WEBPACK_AMD_DEFINE_FACTORY__ = (#),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.call(exports, __webpack_require__, exports, module)) :\n\t\t\t\t__WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))"],
        af: ["var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;", "!(__WEBPACK_AMD_DEFINE_ARRAY__ = #, __WEBPACK_AMD_DEFINE_RESULT__ = (#).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))"],
        ao: ["", "!(#, module.exports = #)"],
        aof: ["var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;", "!(__WEBPACK_AMD_DEFINE_ARRAY__ = #, __WEBPACK_AMD_DEFINE_FACTORY__ = (#),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__))"],
        lf: ["var XXX, XXXmodule;", "!(XXXmodule = { id: YYY, exports: {}, loaded: false }, XXX = #.call(XXXmodule.exports, __webpack_require__, XXXmodule.exports, XXXmodule), XXXmodule.loaded = true, XXX === undefined && (XXX = XXXmodule.exports))"],
        lo: ["var XXX;", "!(XXX = #)"],
        lof: ["var XXX, XXXfactory, XXXmodule;", "!(XXXfactory = (#), (XXXmodule = { id: YYY, exports: {}, loaded: false }), XXX = (typeof XXXfactory === 'function' ? (XXXfactory.call(XXXmodule.exports, __webpack_require__, XXXmodule.exports, XXXmodule)) : XXXfactory), (XXXmodule.loaded = true), XXX === undefined && (XXX = XXXmodule.exports))"],
        laf: ["var __WEBPACK_AMD_DEFINE_ARRAY__, XXX;", "!(__WEBPACK_AMD_DEFINE_ARRAY__ = #, XXX = ((#).apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)))"],
        lao: ["var XXX;", "!(#, XXX = #)"],
        laof: ["var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_FACTORY__, XXX;", "!(__WEBPACK_AMD_DEFINE_ARRAY__ = #, __WEBPACK_AMD_DEFINE_FACTORY__ = (#),\n\t\t\t\tXXX = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__))"]
      };
    }
  }]);

  return AMDDefineDependencyTemplate;
}();

module.exports = AMDDefineDependency;