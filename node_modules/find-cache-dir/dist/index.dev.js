'use strict';

var path = require('path');

var commonDir = require('commondir');

var pkgDir = require('pkg-dir');

var makeDir = require('make-dir');

module.exports = function () {
  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var name = options.name;
  var directory = options.cwd;

  if (options.files) {
    directory = commonDir(directory, options.files);
  } else {
    directory = directory || process.cwd();
  }

  directory = pkgDir.sync(directory);

  if (directory) {
    directory = path.join(directory, 'node_modules', '.cache', name);

    if (directory && options.create) {
      makeDir.sync(directory);
    }

    if (options.thunk) {
      return function () {
        for (var _len = arguments.length, arguments_ = new Array(_len), _key = 0; _key < _len; _key++) {
          arguments_[_key] = arguments[_key];
        }

        return path.join.apply(path, [directory].concat(arguments_));
      };
    }
  }

  return directory;
};