"use strict";

exports.set = function (target, path, value) {
  var fields = path.split('.');
  var obj = target;
  var l = fields.length;

  for (var i = 0; i < l - 1; i++) {
    var key = fields[i];

    if (!obj[key]) {
      obj[key] = {};
    }

    obj = obj[key];
  }

  obj[fields[l - 1]] = value;
};

exports.get = function (target, path) {
  var fields = path.split('.');
  var obj = target;
  var l = fields.length;

  for (var i = 0; i < l - 1; i++) {
    var key = fields[i];

    if (!obj[key]) {
      return undefined;
    }

    obj = obj[key];
  }

  return obj[fields[l - 1]];
};

exports.unset = function (target, path) {
  var fields = path.split('.');
  var obj = target;
  var l = fields.length;
  var objs = [];

  for (var i = 0; i < l - 1; i++) {
    var key = fields[i];

    if (!obj[key]) {
      return;
    }

    objs.unshift({
      parent: obj,
      key: key,
      value: obj[key]
    });
    obj = obj[key];
  }

  delete obj[fields[l - 1]]; // Clear empty objects

  for (var _i = 0, _objs = objs; _i < _objs.length; _i++) {
    var _objs$_i = _objs[_i],
        parent = _objs$_i.parent,
        _key = _objs$_i.key,
        value = _objs$_i.value;

    if (!Object.keys(value).length) {
      delete parent[_key];
    }
  }
};